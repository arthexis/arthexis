{% load i18n admin_extras favorites %}
{% badge_counters app_label model.object_name as model_badges %}
{% model_rule_status app_label model.object_name as model_rule %}

<tr class="model-{{ model_name }}{% if model.admin_url in request.path|urlencode %} current-model{% endif %}"
    data-model-status-url="{% url 'admin-dashboard-model-status' app_label model.object_name %}"
    data-app-label="{{ app_label }}"
    data-model-name="{{ model.object_name }}"
    data-badges-loading="{{ model_badges.loading|yesno:'true,false' }}"
    data-rules-loading="{{ model_rule.loading|yesno:'true,false' }}">
  <th scope="row" id="{{ row_dom_id }}">
    {% if ct_id %}
      <form method="post" action="{% url 'admin:favorite_toggle' ct_id %}" class="favorite-toggle-form">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.get_full_path|urlencode }}">
        {% if fav %}
          <input type="hidden" name="remove" value="1">
        {% else %}
          <input type="hidden" name="user_data" value="on">
        {% endif %}
        <button type="submit" class="favorite-star{% if fav %} favorited{% endif %}" title="{% translate 'Toggle favorite' %}" aria-label="{% translate 'Toggle favorite' %}">&#9733;</button>
      </form>
    {% endif %}
    {% if model.admin_url %}
      <a href="{{ model.admin_url }}"{% if model.admin_url in request.path|urlencode %} aria-current="page"{% endif %}>{{ fav.custom_label|default:model.name }}</a>
    {% else %}
      {{ fav.custom_label|default:model.name }}
    {% endif %}
    {% if show_model_badges %}
      <span class="model-status-group" aria-live="polite">
        <span class="model-status-loading"{% if not model_badges.loading and not model_rule.loading %} hidden{% endif %}>
          {% translate 'Loading statusâ€¦' %}
        </span>
        <span class="model-badges" data-model-badges>
          {% for badge in model_badges.badges %}
            <span class="{{ badge.css_class }}" aria-label="{{ badge.label }}" title="{{ badge.label }}">{{ badge.primary }}{% if badge.secondary %} {{ badge.separator }} {{ badge.secondary }}{% endif %}</span>
          {% endfor %}
        </span>
        <span class="model-rule" data-model-rule>
          {% if model_rule.rule %}
            <span class="model-rule-status{% if model_rule.rule.success %} model-rule-status--success{% else %} model-rule-status--error{% endif %}">
              <span class="model-rule-status__icon" aria-hidden="true">{{ model_rule.rule.icon }}</span>
              <span class="model-rule-status__message">{{ model_rule.rule.message }}</span>
            </span>
          {% endif %}
        </span>
      </span>
    {% endif %}
  </th>

  {% if model.admin_url and show_changelinks %}
    {% model_admin_actions app_label model.object_name as extra_actions %}
    <td class="actions" data-label="{% translate 'Model actions' %}">
      {% for action in extra_actions %}
        <a href="{{ action.url }}" class="actionlink" aria-describedby="{{ row_dom_id }}">{{ action.label }}</a>{% if not forloop.last %}&nbsp;{% endif %}
      {% endfor %}
    </td>
  {% else %}
    <td class="actions"></td>
  {% endif %}

  {% if model.add_url %}
    <td data-label="{% translate 'Add' %}"><a href="{{ model.add_url }}" class="addlink" aria-describedby="{{ row_dom_id }}">{% translate 'Add' %}</a></td>
  {% else %}
    <td data-label="{% translate 'Add' %}"></td>
  {% endif %}

  {% if model.admin_url and show_changelinks %}
    <td class="change-link-cell{% if model.view_only %} change-link-cell--view-only{% endif %}" data-label="{% translate 'Change or view list link' %}">
      {% if model.view_only %}
        <a href="{{ model.admin_url }}" class="viewlink" aria-describedby="{{ row_dom_id }}">{% translate 'View' %}</a>
      {% else %}
        <a href="{{ model.admin_url }}" class="changelink" aria-describedby="{{ row_dom_id }}" target="_blank" rel="noopener noreferrer">{% translate 'Change' %} {{ fav.custom_label|default:model.name }}</a>
      {% endif %}
    </td>
  {% elif show_changelinks %}
    <td class="change-link-cell" data-label="{% translate 'Change or view list link' %}"></td>
  {% endif %}
</tr>
