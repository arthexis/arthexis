{% load i18n admin_extras favorites %}

{% if app_list %}
  {% for app in app_list %}
    <div class="app-{{ app.app_label }} module{% if app.app_url in request.path|urlencode %} current-app{% endif %}">
      <table>
        <caption>
          <a href="{{ app.app_url }}" class="section" title="{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}">{{ app.name }}</a>
        </caption>
        <thead class="visually-hidden">
          <tr>
            <th scope="col">{% translate 'Model name' %}</th>
            <th scope="col">{% translate 'Model actions' %}</th>
            <th scope="col">{% translate 'Add link' %}</th>
            <th scope="col">{% translate 'Change or view list link' %}</th>
          </tr>
        </thead>
        {% for model in app.models %}
          {% with model_name=model.object_name|lower %}
            {% favorite_ct_id app.app_label model.object_name as ct_id %}
            {% favorite_get ct_id as fav %}
            <tr class="model-{{ model_name }}{% if model.admin_url in request.path|urlencode %} current-model{% endif %}">
              <th scope="row" id="{{ app.app_label }}-{{ model_name }}">
                {% if ct_id %}
                  <a href="{% url 'admin:favorite_toggle' ct_id %}?next={{ request.get_full_path|urlencode }}" class="favorite-star{% if fav %} favorited{% endif %}" title="Toggle favorite">&#9733;</a>
                {% endif %}
                {% model_db_status app.app_label model.object_name as model_ok %}
                {% if model_ok %}
                  {% translate 'Installed' as status_label %}
                {% else %}
                  {% translate 'Missing' as status_label %}
                {% endif %}
                <span class="model-status {% if model_ok %}ok{% else %}missing{% endif %}" title="{{ status_label }}" aria-label="{{ status_label }}"></span>
                {% if model.admin_url %}
                  <a href="{{ model.admin_url }}"{% if model.admin_url in request.path|urlencode %} aria-current="page"{% endif %}>{{ fav.custom_label|default:model.name }}</a>
                {% else %}
                  {{ fav.custom_label|default:model.name }}
                {% endif %}
              </th>

              {% if model.admin_url and show_changelinks %}
                {% model_admin_actions app.app_label model.object_name as extra_actions %}
                <td class="actions">
                  {% if app.app_label == 'core' and model.object_name == 'Package' %}
                    <a href="{% url 'admin:core_package_prepare_next_release' %}" class="actionlink" aria-describedby="{{ app.app_label }}-{{ model_name }}">Prepare next Release</a>
                  {% endif %}
                  {% for action in extra_actions %}
                    <a href="{{ action.url }}" class="actionlink" aria-describedby="{{ app.app_label }}-{{ model_name }}">{{ action.label }}</a>
                  {% endfor %}
                </td>
              {% else %}
                <td class="actions"></td>
              {% endif %}

              {% if model.add_url %}
                <td><a href="{{ model.add_url }}" class="addlink" aria-describedby="{{ app.app_label }}-{{ model_name }}">{% translate 'Add' %}</a></td>
              {% else %}
                <td></td>
              {% endif %}

              {% if model.admin_url and show_changelinks %}
                <td>
                  <span class="change-auth-links">
                    {% if model.view_only %}
                      <a href="{{ model.admin_url }}" class="viewlink" aria-describedby="{{ app.app_label }}-{{ model_name }}">{% translate 'View' %}</a>
                    {% else %}
                      <a href="{{ model.admin_url }}" class="changelink" aria-describedby="{{ app.app_label }}-{{ model_name }}">{% translate 'Browse' %}</a>
                    {% endif %}
                    <a href="{% url 'admin:model_permissions' app.app_label model.object_name|lower %}" class="authlink" aria-describedby="{{ app.app_label }}-{{ model_name }}" title="{% translate 'Edit permissions' %}"><span class="model-lock"></span>{% translate 'Auth' %}</a>
                  </span>
                </td>
              {% elif show_changelinks %}
                <td></td>
              {% endif %}
            </tr>
          {% endwith %}
        {% endfor %}
      </table>
    </div>
  {% endfor %}
{% else %}
  <p>{% translate 'You donâ€™t have permission to view or edit anything.' %}</p>
{% endif %}
