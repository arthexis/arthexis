{% extends "admin/base_site.html" %}
{% load i18n %}

{% block extrastyle %}
  {{ block.super }}
  <style>
    .model-graph-wrapper {
      background: var(--darkened-bg);
      border: 1px solid var(--hairline-color);
      padding: 1rem;
      overflow: auto;
      margin-bottom: 1.5rem;
    }
    .model-graph svg {
      max-width: none;
    }
    .model-graph__status {
      margin: 0;
      color: var(--body-quiet-color);
    }
    .model-graph__status.error {
      color: var(--error-fg);
    }
    .model-graph-list {
      columns: 2;
      gap: 1rem;
    }
    @media (max-width: 900px) {
      .model-graph-list {
        columns: 1;
      }
    }
  </style>
{% endblock %}

{% block breadcrumbs %}
  <div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
    › <a href="{% url 'admin:app_list' app_label %}">{{ app_verbose_name }}</a>
    › {% translate 'Model graph' %}
  </div>
{% endblock %}

{% block content %}
  <h1>{{ app_verbose_name }} {% translate 'model graph' %}</h1>
  <p class="help">{% blocktranslate %}This diagram is rendered with Graphviz and reflects the models registered in the {{ app_verbose_name }} admin group, including their relationships.{% endblocktranslate %}</p>

  <div class="model-graph-wrapper">
    <div id="model-graph" class="model-graph">
      {% if graph_svg %}
        <div class="model-graph__figure">
          {{ graph_svg|safe }}
        </div>
      {% else %}
        <p class="model-graph__status error">
          {{ graph_error|default:_('Unable to render the diagram. Check the server logs for details.') }}
        </p>
      {% endif %}
    </div>
  </div>

  {% if models %}
    <h2>{% translate 'Included models' %}</h2>
    <ul class="model-graph-list">
      {% for model in models %}
        <li>
          {% if model.url %}
            <a href="{{ model.url }}">{{ model.label }}</a>
          {% else %}
            {{ model.label }}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  {# Retain the DOT source for debugging or external tooling if needed. #}
  {{ graph_source|json_script:"model-graph-data" }}
{% endblock %}
