# Ownership and security model

This project standardizes models that belong to either a single user or a security group using the `Ownable` abstract base class located in `apps/core/models/ownable.py`. Ownable models expose shared behaviors, admin helpers, and sigil shortcuts so that ownership works consistently across the platform.

## Key behaviors

- **Mutually exclusive owners:** An Ownable record must be owned by exactly one user *or* one security group. Validation runs in both the admin UI and model `clean()` method to block multiple owners and to require one owner on the models that use this security layer.
- **Common helpers:** Each Ownable model exposes `owner` and `owner_display()` for human-readable labels, plus `owner_members()` for expanding a group into usernames.
- **Sigils:** When resolving sigils with the object supplied as `current`, `[OBJECT.OWNER]` returns the display value of the owner (user or security group) and `[OBJECT.OWNERS]` returns a JSON array of usernames (for a user owner this is a single entry; for a security group it lists every member).

## Admin experience

- All Ownable admin classes inherit `OwnableAdminMixin`, which normalizes the Owner fieldset and applies validation before saving.
- User and Security Group change forms now show an **Owned objects** section summarizing:
  - Directly owned objects (owner is the current user/group).
  - Objects owned through a related security group or through group members, with the source called out.
- The summary entries link back to the corresponding admin change pages when available for quick navigation.

## Developer guidance

1. **Make a model ownable**
   - Inherit from `Ownable` (or from `Profile`, which now derives from `Ownable`).
   - Set `owner_required = True` when the model must always be linked to a user or security group.
   - Keep business-specific validation in `clean()` but rely on the shared ownership checks instead of duplicating them.
2. **Admin setup**
   - Ensure the model's `ModelAdmin` subclasses `OwnableAdminMixin` (in addition to existing mixins) so the Owner fieldset and validation are applied.
   - For proxy or inline admins, reuse the same mixin or the dynamically wrapped form generated by the mixin.
3. **Surface ownership in staff tooling**
   - Use `get_owned_objects_for_user()` and `get_owned_objects_for_group()` to summarize ownership for dashboards or reports.
4. **Use sigils for templates and notifications**
   - When rendering text that has access to the current Ownable instance, `[OBJECT.OWNER]` and `[OBJECT.OWNERS]` provide owner-aware placeholders without custom code.

Only models that already expressed ownership via user/group fields were upgraded to use `Ownable` in this iteration. Future models can opt in by following the steps above if they should participate in the ownership security model.
