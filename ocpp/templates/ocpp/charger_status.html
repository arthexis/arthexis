{% extends "website/base.html" %}

{% load i18n %}

{% block title %}{{ charger.name|default:charger.charger_id }} - {% trans "Status" %}{% endblock %}

{% block content %}
<div id="status-content">
  <h1>{{ charger.name|default:charger.charger_id }}</h1>
  <p>Serial Number: {{ charger.charger_id }}</p>
  <div class="mb-3 d-flex align-items-center">
    <span class="d-inline-block rounded-circle me-2" style="width:20px;height:20px;background-color: {{ color }};"></span>
    <strong>{{ state }}</strong>
  </div>
  <p>{% trans "Total Energy" %}: {{ charger.total_kwh|floatformat:2 }} kWh</p>
  {% if tx %}
  <h2>{% trans "Current Transaction" %}</h2>
  <ul>
    <li>{% trans "Transaction ID" %}: {{ tx.id }}</li>
    <li>{% trans "Meter Start" %}: {{ tx.meter_start }}</li>
    <li>{% trans "Start Time" %}: {{ tx.start_time }}</li>
    <li>{% trans "Session Energy" %}: {{ tx.kwh|floatformat:2 }} kWh</li>
  </ul>
  {% else %}
  <p>{% trans "No active transaction" %}</p>
  {% endif %}

  <h2>{% trans "Sessions" %}</h2>
  <table class="table">
    <thead>
      <tr>
        <th>{% trans "ID" %}</th>
        <th>{% trans "Start" %}</th>
        <th>{% trans "Stop" %}</th>
        <th>{% trans "Energy (kWh)" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for tx in transactions %}
      <tr>
        <td>{{ tx.id }}</td>
        <td>{{ tx.start_time }}</td>
        <td>{{ tx.stop_time|default:"-" }}</td>
        <td>{{ tx.kwh|floatformat:2 }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="4">{% trans "No sessions found." %}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<script>
  function reloadStatus() {
    fetch(window.location.href, {headers: {'X-Requested-With': 'XMLHttpRequest'}})
      .then(resp => resp.text())
      .then(html => {
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const newContent = doc.getElementById('status-content');
        if (newContent) {
          document.getElementById('status-content').innerHTML = newContent.innerHTML;
        }
      });
  }
  setInterval(reloadStatus, 5000);
</script>
{% endblock %}
