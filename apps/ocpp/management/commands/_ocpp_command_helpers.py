"""Shared CLI helpers for OCPP management commands."""

from __future__ import annotations

import warnings


def add_coverage_arguments(parser) -> None:
    """Add common coverage output arguments."""
    parser.add_argument(
        "--badge-path",
        default=None,
        help="Optional path to write the SVG badge.",
    )
    parser.add_argument(
        "--json-path",
        default=None,
        help="Optional path to write the JSON summary.",
    )


def add_transactions_import_arguments(parser) -> None:
    """Add common transaction import arguments."""
    parser.add_argument(
        "input", help="Path to JSON file generated by `ocpp transactions export`."
    )


def add_transactions_export_arguments(parser) -> None:
    """Add common transaction export arguments."""
    parser.add_argument("output", help="Path to output JSON file")
    parser.add_argument(
        "--start",
        help="Start date (YYYY-MM-DD or ISO datetime) to filter transactions",
    )
    parser.add_argument(
        "--end",
        help="End date (YYYY-MM-DD or ISO datetime) to filter transactions",
    )
    parser.add_argument(
        "--chargers",
        nargs="*",
        help="List of charger IDs to include. If omitted all chargers are exported.",
    )


def add_trace_extract_arguments(parser) -> None:
    """Add common trace extraction arguments."""
    parser.add_argument(
        "--all",
        action="store_true",
        help="List all transactions with energy transfer",
    )
    parser.add_argument(
        "--next",
        type=int,
        default=10,
        help="Number of recent transactions to list (default: 10)",
    )
    parser.add_argument(
        "--txn",
        help="Transaction id or OCPP transaction id to inspect",
    )
    parser.add_argument(
        "--out",
        help="Path to write an extract file for --txn",
    )
    parser.add_argument(
        "--log",
        help="Path to write the charger log segment for --txn",
    )


def add_trace_replay_arguments(parser) -> None:
    """Add common trace replay arguments."""
    parser.add_argument(
        "extract",
        help="Path to extract JSON generated by `ocpp trace extract --out`",
    )


def warn_deprecated_command(old_command: str, new_usage: str) -> None:
    """Emit a deprecation warning for an old command surface."""
    warnings.warn(
        (
            f"`manage.py {old_command}` is deprecated and will be removed in a future "
            f"release. Use `manage.py {new_usage}` instead."
        ),
        UserWarning,
        stacklevel=2,
    )
