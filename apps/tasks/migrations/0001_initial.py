# Generated by Django 5.2.8 on 2025-12-02 21:38

import django.core.validators
import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ("core", "0004_delete_rfid"),
        ("maps", "0001_initial"),
        ("nodes", "0001_initial"),
        ("odoo", "0002_initial"),
        ("teams", "0002_remove_odooemployee"),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.CreateModel(
                    name="TaskCategory",
                    fields=[
                        (
                            "id",
                            models.BigAutoField(
                                auto_created=True,
                                primary_key=True,
                                serialize=False,
                                verbose_name="ID",
                            ),
                        ),
                        ("is_seed_data", models.BooleanField(default=False, editable=False)),
                        ("is_user_data", models.BooleanField(default=False, editable=False)),
                        ("is_deleted", models.BooleanField(default=False, editable=False)),
                        (
                            "name",
                            models.CharField(max_length=200, verbose_name="Name"),
                        ),
                        (
                            "description",
                            models.TextField(
                                blank=True,
                                help_text="Optional details supporting Markdown formatting.",
                                verbose_name="Description",
                            ),
                        ),
                        (
                            "image",
                            models.ImageField(
                                blank=True,
                                upload_to="workgroup/task_categories/",
                                verbose_name="Image",
                            ),
                        ),
                        (
                            "cost",
                            models.DecimalField(
                                blank=True,
                                decimal_places=2,
                                help_text="Estimated fulfillment cost in local currency.",
                                max_digits=10,
                                null=True,
                                validators=[
                                    django.core.validators.MinValueValidator(Decimal("0"))
                                ],
                                verbose_name="Cost",
                            ),
                        ),
                        (
                            "default_duration",
                            models.DurationField(
                                blank=True,
                                help_text="Typical time expected to complete tasks in this category.",
                                null=True,
                                verbose_name="Default duration",
                            ),
                        ),
                        (
                            "availability",
                            models.CharField(
                                choices=[
                                    ("none", "None"),
                                    ("immediate", "Immediate"),
                                    ("2_3_business_days", "2-3 business days"),
                                    ("2_3_weeks", "2-3 weeks"),
                                    ("unavailable", "Unavailable"),
                                ],
                                default="none",
                                help_text="Typical lead time for scheduling this work.",
                                max_length=32,
                                verbose_name="Availability",
                            ),
                        ),
                        (
                            "assigned_group",
                            models.ForeignKey(
                                blank=True,
                                help_text="Security group typically assigned to this work.",
                                null=True,
                                on_delete=django.db.models.deletion.SET_NULL,
                                related_name="task_categories_as_assignee",
                                to="core.securitygroup",
                                verbose_name="Assigned to group",
                            ),
                        ),
                        (
                            "manager",
                            models.ForeignKey(
                                blank=True,
                                help_text="User responsible for overseeing this category.",
                                null=True,
                                on_delete=django.db.models.deletion.SET_NULL,
                                related_name="managed_task_categories",
                                to=settings.AUTH_USER_MODEL,
                                verbose_name="Manager",
                            ),
                        ),
                        (
                            "odoo_products",
                            models.ManyToManyField(
                                blank=True,
                                help_text="Relevant Odoo products for this category.",
                                related_name="task_categories",
                                to="odoo.odooproduct",
                                verbose_name="Odoo products",
                            ),
                        ),
                        (
                            "requestor_group",
                            models.ForeignKey(
                                blank=True,
                                help_text="Security group authorized to request this work.",
                                null=True,
                                on_delete=django.db.models.deletion.SET_NULL,
                                related_name="task_categories_as_requestor",
                                to="core.securitygroup",
                                verbose_name="Requestor group",
                            ),
                        ),
                    ],
                    options={
                        "verbose_name": "Task Category",
                        "verbose_name_plural": "Task Categories",
                        "db_table": "core_taskcategory",
                        "ordering": ("name",),
                    },
                ),
                migrations.CreateModel(
                    name="ManualTask",
                    fields=[
                        (
                            "id",
                            models.BigAutoField(
                                auto_created=True,
                                primary_key=True,
                                serialize=False,
                                verbose_name="ID",
                            ),
                        ),
                        ("is_seed_data", models.BooleanField(default=False, editable=False)),
                        ("is_user_data", models.BooleanField(default=False, editable=False)),
                        ("is_deleted", models.BooleanField(default=False, editable=False)),
                        (
                            "description",
                            models.TextField(
                                help_text="Detailed summary of the work to perform.",
                                verbose_name="Requestor Comments",
                            ),
                        ),
                        (
                            "duration",
                            models.DurationField(
                                blank=True,
                                help_text="Estimated time to complete the task.",
                                null=True,
                                verbose_name="Expected duration",
                            ),
                        ),
                        (
                            "scheduled_start",
                            models.DateTimeField(
                                help_text="Planned start time for this work.",
                                verbose_name="Scheduled start",
                            ),
                        ),
                        (
                            "scheduled_end",
                            models.DateTimeField(
                                help_text="Planned completion time for this work.",
                                verbose_name="Scheduled end",
                            ),
                        ),
                        (
                            "enable_notifications",
                            models.BooleanField(
                                default=False,
                                help_text="Send reminder emails to the assigned contacts when Celery notifications are available.",
                                verbose_name="Enable notifications",
                            ),
                        ),
                        (
                            "assigned_group",
                            models.ForeignKey(
                                blank=True,
                                help_text="Security group containing users who can fulfill the task.",
                                null=True,
                                on_delete=django.db.models.deletion.SET_NULL,
                                related_name="assigned_manual_tasks",
                                to="core.securitygroup",
                                verbose_name="Potential assignees",
                            ),
                        ),
                        (
                            "assigned_user",
                            models.ForeignKey(
                                blank=True,
                                help_text="Optional user responsible for the task.",
                                null=True,
                                on_delete=django.db.models.deletion.SET_NULL,
                                related_name="assigned_manual_tasks",
                                to=settings.AUTH_USER_MODEL,
                                verbose_name="Assigned user",
                            ),
                        ),
                        (
                            "category",
                            models.ForeignKey(
                                blank=True,
                                help_text="Select the standardized category for this work.",
                                null=True,
                                on_delete=django.db.models.deletion.SET_NULL,
                                related_name="manual_tasks",
                                to="tasks.taskcategory",
                                verbose_name="Category",
                            ),
                        ),
                        (
                            "location",
                            models.ForeignKey(
                                blank=True,
                                help_text="Location associated with this manual task.",
                                null=True,
                                on_delete=django.db.models.deletion.SET_NULL,
                                related_name="manual_tasks",
                                to="maps.location",
                                verbose_name="Location",
                            ),
                        ),
                        (
                            "manager",
                            models.ForeignKey(
                                blank=True,
                                help_text="User overseeing the task.",
                                null=True,
                                on_delete=django.db.models.deletion.SET_NULL,
                                related_name="managed_manual_tasks",
                                to=settings.AUTH_USER_MODEL,
                                verbose_name="Manager",
                            ),
                        ),
                        (
                            "node",
                            models.ForeignKey(
                                blank=True,
                                help_text="Node where this manual task should be completed.",
                                null=True,
                                on_delete=django.db.models.deletion.SET_NULL,
                                related_name="manual_tasks",
                                to="nodes.node",
                                verbose_name="Node",
                            ),
                        ),
                        (
                            "odoo_products",
                            models.ManyToManyField(
                                blank=True,
                                help_text="Products associated with the requested work.",
                                related_name="manual_tasks",
                                to="odoo.odooproduct",
                                verbose_name="Odoo products",
                            ),
                        ),
                    ],
                    options={
                        "verbose_name": "Manual Task",
                        "verbose_name_plural": "Manual Tasks",
                        "db_table": "core_manualtask",
                        "ordering": ("scheduled_start", "category__name"),
                        "constraints": [
                            models.CheckConstraint(
                                name="manualtask_requires_target",
                                condition=models.Q(node__isnull=False)
                                | models.Q(location__isnull=False),
                            ),
                            models.CheckConstraint(
                                name="manualtask_schedule_order",
                                condition=models.Q(
                                    scheduled_end__gte=models.F("scheduled_start")
                                ),
                            ),
                        ],
                    },
                ),
            ],
            database_operations=[],
        )
    ]
