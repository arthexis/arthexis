# Generated by Django 5.2.8 on 2025-11-28 22:15

from datetime import timedelta

from django.db import migrations


def add_charge_point_maintenance_category(apps, schema_editor):
    TaskCategory = apps.get_model("teams", "TaskCategory")

    category_defaults = {
        "description": "Routine upkeep and inspection tasks for charge points.",
        "default_duration": timedelta(hours=2),
        "availability": "immediate",
        "is_seed_data": True,
    }

    category, created = TaskCategory.all_objects.get_or_create(
        name="Charge Point Maintenance", defaults=category_defaults
    )

    updated = False
    for field, value in category_defaults.items():
        if getattr(category, field) != value:
            setattr(category, field, value)
            updated = True

    if category.is_deleted:
        category.is_deleted = False
        updated = True

    if updated:
        category.save()


def remove_charge_point_maintenance_category(apps, schema_editor):
    TaskCategory = apps.get_model("teams", "TaskCategory")

    TaskCategory.all_objects.filter(
        name="Charge Point Maintenance", is_seed_data=True, is_user_data=False
    ).update(is_deleted=True)


class Migration(migrations.Migration):

    dependencies = [
        ("teams", "0023_alter_manualtask_description_verbose_name"),
    ]

    operations = [
        migrations.RunPython(
            add_charge_point_maintenance_category,
            remove_charge_point_maintenance_category,
        ),
    ]
