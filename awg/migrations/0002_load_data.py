import csv
from io import StringIO
from django.db import migrations

CABLE_DATA = """awg_size,material,dia_in,dia_mm,area_kcmil,area_mm2,k_ohm_km,k_ohm_kft,amps_60c,amps_75c,amps_90c,line_num
-4,cu,0.46,11.684,212,107,0.1608,0.04901,409,483,546,3
-4,cu,0.46,11.684,212,107,0.1608,0.04901,312,368,416,2
-4,cu,0.46,11.684,212,107,0.1608,0.04901,195,230,260,1
-3,cu,0.4096,10.405,168,85,0.2028,0.0618,346,420,472,3
-3,cu,0.4096,10.405,168,85,0.2028,0.0618,264,320,360,2
-3,cu,0.4096,10.405,168,85,0.2028,0.0618,165,200,225,1
-2,cu,0.3648,9.266,133,67.4,0.2557,0.07793,304,367,409,3
-2,cu,0.3648,9.266,133,67.4,0.2557,0.07793,232,280,312,2
-2,cu,0.3648,9.266,133,67.4,0.2557,0.07793,145,175,195,1
-1,cu,0.3249,8.251,106,53.5,0.3224,0.09827,262,315,357,3
-1,cu,0.3249,8.251,106,53.5,0.3224,0.09827,200,240,272,2
-1,cu,0.3249,8.251,106,53.5,0.3224,0.09827,125,150,170,1
1,cu,0.2893,7.348,83.7,42.4,0.4066,0.1239,110,130,145,1
2,cu,0.2576,6.544,66.4,33.4,0.5127,0.1563,95,115,130,1
3,cu,0.2294,5.827,52.6,26.7,0.6465,0.197,85,100,115,1
4,cu,0.2043,5.189,41.7,21.2,0.8152,0.2485,70,85,95,1
6,cu,0.162,4.115,26.3,13.3,1.296,0.3951,55,65,75,1
8,cu,0.1285,3.264,16.5,8.37,2.061,0.6282,40,50,55,1
10,cu,0.1019,2.588,10.4,5.26,3.277,0.9989,30,35,40,1
12,cu,0.0808,2.053,6.53,3.31,5.211,1.588,20,25,30,1
14,cu,0.0641,1.628,4.11,2.08,8.286,2.525,15,20,25,1
-4,al,0.46,11.684,212,107,0.1608,0.04901,315,378,430,3
-4,al,0.46,11.684,212,107,0.1608,0.04901,240,288,328,2
-4,al,0.46,11.684,212,107,0.1608,0.04901,150,180,205,1
-3,al,0.4096,10.405,168,85,0.2028,0.0618,273,325,367,3
-3,al,0.4096,10.405,168,85,0.2028,0.0618,208,248,280,2
-3,al,0.4096,10.405,168,85,0.2028,0.0618,130,155,175,1
-2,al,0.3648,9.266,133,67.4,0.2557,0.07793,241,283,315,3
-2,al,0.3648,9.266,133,67.4,0.2557,0.07793,184,216,240,2
-2,al,0.3648,9.266,133,67.4,0.2557,0.07793,115,135,150,1
-1,al,0.3249,8.251,106,53.5,0.3224,0.09827,210,252,283,3
-1,al,0.3249,8.251,106,53.5,0.3224,0.09827,160,192,216,2
-1,al,0.3249,8.251,106,53.5,0.3224,0.09827,100,120,135,1
1,al,0.2893,7.348,83.7,42.4,0.4066,0.1239,85,100,115,1
2,al,0.2576,6.544,66.4,33.4,0.5127,0.1563,75,90,100,1
3,al,0.2294,5.827,52.6,26.7,0.6465,0.197,65,75,85,1
4,al,0.2043,5.189,41.7,21.2,0.8152,0.2485,55,65,75,1
6,al,0.162,4.115,26.3,13.3,1.296,0.3951,40,50,55,1
8,al,0.1285,3.264,16.5,8.37,2.061,0.6282,35,40,45,1
10,al,0.1019,2.588,10.4,5.26,3.277,0.9989,25,30,35,1
12,al,0.0808,2.053,6.53,3.31,5.211,1.588,15,20,25,1
14,al,0.0641,1.628,4.11,2.08,8.286,2.525,0,0,0,1
"""

FILL_DATA = """trade_size,conduit,awg_14,awg_12,awg_10,awg_8,awg_6,awg_4,awg_3,awg_2,awg_1,awg_0,awg_00,awg_000,awg_0000
1/2,EMT,12,9,5,3,2,1,1,1,1,1,,,
1/2,IMC,14,10,6,3,2,1,1,1,1,1,1,,
1/2,RMC,13,9,6,3,2,1,1,1,1,1,,,
1/2,FMC,13,9,6,3,2,1,1,1,1,1,,,
3/4,EMT,22,16,10,6,4,2,1,1,1,1,1,1,1
3/4,IMC,24,17,11,6,4,3,2,1,1,1,1,1,1
3/4,RMC,22,16,10,6,4,2,1,1,1,1,1,1,1
3/4,FMC,22,16,10,6,4,2,1,1,1,1,1,1,1
1,EMT,35,26,16,9,7,4,3,3,1,1,1,1,1
1,IMC,39,29,18,10,7,4,4,3,2,1,1,1,1
1,RMC,36,26,17,9,7,4,3,3,1,1,1,1,1
1,FMC,33,24,15,9,6,4,3,3,1,1,1,1,1
1 1/4,EMT,61,45,28,16,12,7,6,5,4,3,2,1,1
1 1/4,IMC,68,49,31,18,13,8,6,5,4,3,3,2,1
1 1/4,RMC,63,46,29,16,12,7,6,5,4,3,2,1,1
1 1/4,FMC,52,38,24,14,10,6,5,4,3,2,1,1,1
1 1/2,EMT,84,61,38,22,16,10,8,7,5,4,3,3,2
1 1/2,IMC,91,67,42,24,17,11,9,7,5,4,4,3,2
1 1/2,RMC,85,62,39,22,16,10,8,7,5,4,3,3,2
1 1/2,FMC,76,56,35,20,14,9,7,6,4,4,3,2,1
2,EMT,138,101,63,36,26,16,13,11,8,7,6,5,4
2,IMC,149,109,69,39,28,17,15,12,9,8,6,5,4
2,RMC,140,102,64,37,27,16,14,11,8,7,6,5,4
2,FMC,135,98,62,35,25,16,13,11,8,7,6,5,4
2 1/2,EMT,241,176,111,64,46,28,24,20,15,12,10,8,7
2 1/2,IMC,211,154,97,56,40,25,21,17,13,11,9,7,6
2 1/2,RMC,200,146,92,53,38,23,20,17,12,10,8,7,6
2 1/2,FMC,202,147,93,53,38,24,20,17,12,10,9,7,6
3,EMT,364,266,167,96,69,43,36,30,22,19,16,13,11
3,IMC,326,238,150,86,62,38,32,27,20,17,14,12,9
3,RMC,309,225,142,82,59,36,31,26,19,16,13,11,9
3,FMC,291,212,134,77,55,34,29,24,18,15,12,10,8
3 1/2,EMT,476,347,219,126,91,56,47,40,29,25,20,17,14
3 1/2,IMC,436,318,200,115,83,51,43,36,27,23,19,16,13
3 1/2,RMC,412,301,189,109,79,48,41,34,25,21,18,15,12
3 1/2,FMC,396,289,182,105,76,46,39,33,24,20,17,14,12
4,EMT,608,443,279,161,116,71,60,51,37,32,26,22,18
4,IMC,562,410,258,149,107,66,56,47,35,29,24,20,17
4,RMC,531,387,244,140,101,62,53,44,33,27,23,19,16
4,FMC,518,378,238,137,99,61,51,43,32,27,22,18,15
"""

def load_data(apps, schema_editor):
    CableSize = apps.get_model("awg", "CableSize")
    ConduitFill = apps.get_model("awg", "ConduitFill")

    reader = csv.DictReader(StringIO(CABLE_DATA.strip()))
    int_fields = {"line_num", "amps_60c", "amps_75c", "amps_90c"}
    records = []
    for row in reader:
        data = {}
        for k, v in row.items():
            if k in {"awg_size", "material"}:
                data[k] = v
            elif k in int_fields:
                data[k] = int(v)
            else:
                data[k] = float(v)
        records.append(CableSize(**data))
    CableSize.objects.bulk_create(records)

    reader = csv.DictReader(StringIO(FILL_DATA.strip()))
    fills = []
    for row in reader:
        for key, value in row.items():
            if value == "":
                row[key] = None
        fills.append(ConduitFill(**row))
    ConduitFill.objects.bulk_create(fills)

class Migration(migrations.Migration):
    dependencies = [
        ("awg", "0001_initial"),
    ]

    operations = [migrations.RunPython(load_data)]
