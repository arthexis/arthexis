{% extends "admin/base_site.html" %}
{% load i18n %}

{% block nav-breadcrumbs %}
<nav aria-label="{% translate 'Breadcrumbs' %}">
  <div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a> ›
    <a href="{% url 'admin:app_list' 'core' %}">{% trans '2. Business' %}</a> ›
    <a href="{% url 'admin:core_packagerelease_changelist' %}">{% trans 'Package Releases' %}</a> ›
    <a href="{% url 'admin:core_packagerelease_change' release.pk %}">{{ release }}</a> ›
    {{ action|capfirst }}
  </div>
</nav>
{% endblock %}

{% block content %}
<h1>{{ action|capfirst }} {{ release.package.name }} {{ release.version }}</h1>
<ol>
{% for step in steps %}
  <li>{% if forloop.counter0 < current_step %}✅{% elif forloop.counter0 == current_step and not done and not error %}⏳{% else %}⬜{% endif %} {{ step }}</li>
{% endfor %}
</ol>
{% if fixtures %}
<h2>{% trans 'Fixture changes' %}</h2>
<table>
  <thead>
    <tr>
      <th>{% trans 'Fixture' %}</th>
      <th>{% trans 'Entries' %}</th>
      <th>{% trans 'Models' %}</th>
    </tr>
  </thead>
  <tbody>
  {% for fx in fixtures %}
    <tr>
      <td>{{ fx.path }}</td>
      <td>{{ fx.count }}</td>
      <td>{{ fx.models|join:', ' }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endif %}
<pre>{{ log_content }}</pre>
{% if error %}
<p class="error">{{ error }}</p>
<form method="get">
  <button type="submit" name="restart" value="1">{% trans 'Restart' %}</button>
</form>
{% elif not done %}
{% if next_step is not None %}
<meta http-equiv="refresh" content="1; url={{ request.path }}?step={{ next_step }}">
{% endif %}
<p>Running...</p>
{% else %}
<p>All steps completed.</p>
{% if release.pypi_url %}
<p><a href="{{ release.pypi_url }}" target="_blank" rel="noopener">{{ release.pypi_url }}</a></p>
{% endif %}
<div>
  <input type="text" id="logpath" value="{{ log_path }}" readonly>
  <button type="button" onclick="navigator.clipboard.writeText(document.getElementById('logpath').value)">Copy log path</button>
</div>
{% if cert_log %}
<p>Certification logged in {{ cert_log }}</p>
{% endif %}
{% endif %}
<p>{% trans 'Restarts' %}: {{ restart_count }}</p>
<form method="get">
  <button type="submit" name="restart" value="1">{% trans 'Restart' %}</button>
</form>
{% endblock %}

