{% extends "admin/base_site.html" %}
{% load i18n %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
  &rsaquo; <a href="{% url 'admin:system' %}">{% trans 'System' %}</a>
  &rsaquo; {% trans "Changelog Report" %}
</div>
{% endblock %}

{% block content %}
<div id="content-main">
  <div class="module open-changelog">
    <div class="changelog-refresh-actions" style="text-align: right; margin-bottom: 0.5rem;">
      <form method="post" class="changelog-refresh-form" style="display: inline-block;">
        {% csrf_token %}
        <input type="hidden" name="action" value="recalculate">
        <button type="submit" class="button default">
          {% trans "Recalculate changelog" %}
        </button>
      </form>
      {% if open_changelog_entries %}
        <button type="submit" class="button" form="changelog-exclude-form" style="display: inline-block; margin-left: 0.5rem;">
          {% trans "Exclude selected" %}
        </button>
      {% endif %}
    </div>
    <h2>{% trans "Open Changelog" %}</h2>
    {% if open_changelog_entries %}
      <form method="post" class="changelog-exclude-form" id="changelog-exclude-form">
        {% csrf_token %}
        <input type="hidden" name="action" value="exclude">
        <table class="table table-striped">
          <thead>
            <tr>
              <th scope="col">{% trans "Select" %}</th>
              <th scope="col">{% trans "Commit" %}</th>
              <th scope="col">{% trans "Message" %}</th>
            </tr>
          </thead>
          <tbody>
          {% for entry in open_changelog_entries %}
            {% with checkbox_id="exclude-sha-"|add:forloop.counter %}
            <tr>
              <td>
                <input type="checkbox" id="{{ checkbox_id }}" name="selected_shas" value="{{ entry.sha }}">
              </td>
              <td>
                <label for="{{ checkbox_id }}"><code>{{ entry.sha }}</code></label>
              </td>
              <td>{{ entry.message|default:"" }}</td>
            </tr>
            {% endwith %}
          {% endfor %}
          </tbody>
        </table>
      </form>
    {% else %}
      <p class="help">{% trans "No pending changelog entries." %}</p>
    {% endif %}
  </div>
</div>
{% endblock %}
